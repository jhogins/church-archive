<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Church Sermon Archive Editor</title>
    <script src="./lib/jsoneditor.js"></script>
    <script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
    <script src="./lib/blob.js"></script>
    <script src="./node_modules/file-saver/FileSaver.js"></script>
    <!-- Foundation CSS framework (Bootstrap and jQueryUI also supported) -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.css'>
    <!-- Font Awesome icons (Bootstrap, Foundation, and jQueryUI also supported) -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.css'>
  </head>
  <body>
    <h1>RBC Sermon Archive Editor</h1>
    
    <button id='save' class='tiny'>Save (sermonarchive.json)</button>
    <div id='editor_holder'></div>
    
    <script>
      JSONEditor.defaults.theme = 'foundation5';
      JSONEditor.defaults.iconlib = 'fontawesome4';

      $.getJSON('./archiveschema.json', function(data) {
        var myengine = {
          compile: function(template) {
            // Compile should return a render function
            return function(vars) {
              // A real template engine would render the template here
              var result = template;
              return result;
            }
          }
        };

        // Initialize the editor with a JSON schema
        var editor = new JSONEditor(document.getElementById('editor_holder'), 
        { 
          schema: data,
          //template: myengine,
          show_errors: 'interaction'
        });
        document.getElementById('save').addEventListener("click", function(event) {
          var errors = editor.validate();
          if (errors.length)
          {
            alert("Cannot save. There are errors in the document.");
          }
          else
          {
            event.preventDefault();
            var stjson = JSON.stringify(editor.getValue(), null, 4);
            saveAs(
                new Blob(
                  [stjson], 
                  {type: "text/plain;charset=utf-8"}
              )
              , "sermonarchive.json"
            );
          }
        }, false);
      })
    </script>
  </body>
</html>
